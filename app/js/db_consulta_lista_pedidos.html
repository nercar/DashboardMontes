<style>
	.minibadge {
		color:#1f2d3d;
		background-color:#ffc107;
		padding-top: .05em;
		padding-bottom: .05em;
		padding-left: .4em;
		padding-right: .4em;
		font-size:60%;
		letter-spacing: -0.1px;
		line-height: 0.7em;
		border-radius: .25em;
		border: 1px solid #000;
		margin: 0px;
	}
	.selectSize {
		width: 100% !important;
	}

	.dataTables_filter {
		display: none;
	}
</style>

<!-- Main row -->
<div class="row">
	<!-- Solicitud de Pedidos -->
	<div class="col-md-12 col-sm-12 mt-2" id="div_tbl_datos">
		<div class="card card-primary elevation-2 border border-dark" style="height: 85vh;">
			<div class="card-header p-1 pl-2 mb-1">
				<i class="fas fa-file-alt"></i>
				<span id="ttitulo">Lista de Pedidos</span>
			</div>
			<div class="row p-0 pl-1 pr-1 m-0">
				<div class="col-3 pl-1 pr-1">
					<table width="100%" cellpadding="5">
						<thead>
							<tr>
								<td colspan="3" class="bg-dark-gradient text-center">Opciones de la Consulta</td>
							</tr>
						</thead>
						<tbody>
							<tr class="text-center bg-primary-gradient">
								<th width="45%">Opción</th>
								<th colspan="2" width="55%">Valor</th>
							</tr>
							<tr>
								<td>Localidad</td>
								<td colspan="2">
									<select id="select_tiendas" class="form-control form-control-sm p-0"></select>
								</td>
							</tr>
							<tr>
								<td>Status</td>
								<td colspan="2">
									<select name="statuspedi" id="statuspedi" class="form-control form-control-sm p-0">
										<option value="0">Pedido</option>
										<option value="1">En Preparación</option>
										<option value="3">Procesadas</option>
										<option value="2">Eliminadas</option>
									</select>
								</td>
							</tr>
							<tr>
								<td colspan="3">
									<div class="m-0 p-0 d-none prioritarios form-inline" title="Seleccionar pedidos con Existencia Local menor o igual a la cantidad indicada">
										<input type="checkbox" id="prioritarios" style="cursor: pointer;">
										<label style="cursor: pointer;" for="prioritarios">
											&nbsp;Artículos Exist. Local <=</label>
											<input type="number" min="0" max="99" id="exlocmin" value="12"
												style="text-align: center; width: 15%; border-radius: 5px;">
									</div>
								</td>
							</tr>
						</tbody>
						<tfoot>
							<tr class="text-center border border-secondary alert-dark">
								<td colspan="3" class="text-center p-2">
									<button class="btn btn-danger btn-sm" onclick="limpiarFiltros()">
										<i class="fas fa-broom"></i> Limpiar
									</button>
									<button class="btn btn-success btn-sm" id="btn_consultar">
										<i class="fas fa-search"></i> Consultar
									</button>
								</td>
							</tr>
						</tfoot>
					</table>
					<div class="mt-5 p-1 m-0" style="display: none;" id="btn_procesar">
						<div class="d-flex w-100 align-content-center justify-content-center">
							<button id="procSoli" class="btn btn-info"><i class="fas fa-check"></i>Procesar</button>
						</div>
					</div>
				</div>
				<div class="col-9 pl-1 pr-1" id="tbl_Pedidos">
					<table width="100%" class="table-striped table-hover table-bordered nowrap" id="tbl_consultaInvPedidosList">
						<thead>
							<tr>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">Fecha Sol.</th>
								<th width="20%" class="text-center txtcomp bg-warning-gradient">Tienda</th>
								<th width="35%" class="text-center txtcomp bg-warning-gradient">Solicidato por</th>
								<th width="10%" class="text-center txtcomp bg-warning-gradient">Nro. Sol.</th>
								<th width="5% " class="text-center txtcomp bg-warning-gradient">Dias</th>
								<th width="15%" class="text-center txtcomp bg-light-gradient  ">Opciones</th>
							</tr>
						</thead>
					</table>
				</div>
				<div class="col-9 pl-1 pr-1" style="display: none" id="tbl_Espera">
					<table width="100%" class="table-striped table-hover table-bordered nowrap" id="tbl_consultaInvEspera">
						<thead>
							<tr>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">Destino</th>
								<th width="10%" class="text-center txtcomp bg-warning-gradient">Despacho</th>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">Fecha Asig.</th>
								<th width="25%" class="text-center txtcomp bg-warning-gradient">Responsable</th>
								<th width="10%" class="text-center txtcomp bg-warning-gradient">Dias</th>
								<th width="20%" class="text-center txtcomp bg-warning-gradient" title="#Transferencia / #Factura (para Montes Plus)">#Transf./#Fact. <span class="text-primary"><i class="fas fa-info-circle"></i></span></th>
								<th width="10%" class="text-center txtcomp bg-ligh-gradient   ">Opciones</th>
							</tr>
						</thead>
					</table>
				</div>
				<div class="col-9 pl-1 pr-1" style="display: none" id="tbl_Procesadas">
					<table width="100%" class="table-striped table-hover table-bordered" id="tbl_consultaInvProcesado">
						<thead>
							<tr>
								<th colspan="7" class="text-center txtcomp bg-dark-gradient">
									Despachos pendientes para ser Transportados
								</th>
							</tr>
							<tr>
								<th width="20%" class="text-center txtcomp bg-warning-gradient">Destino</th>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">N° Pedido</th>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">Fec. Sol.</th>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">N° Despacho</th>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">Fec. Desp.</th>
								<th width="5%"  class="text-center txtcomp bg-warning-gradient">Días</th>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">Transferencias</th>
							</tr>
						</thead>
					</table>
				</div>
				<div class="col-9 pl-1 pr-1" style="display: none" id="tbl_Eliminadas">
					<table width="100%" class="table-striped table-hover table-bordered" id="tbl_consultaInvPedidosElim">
						<thead>
							<tr>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">Fecha Sol.</th>
								<th width="20%" class="text-center txtcomp bg-warning-gradient">Tienda</th>
								<th width="10%" class="text-center txtcomp bg-warning-gradient">N° Sol.</th>
								<th width="15%" class="text-center txtcomp bg-warning-gradient">Fecha Eli.</th>
								<th width="35%" class="text-center txtcomp bg-warning-gradient">Eliminado por</th>
								<th width="5%"  class="text-center txtcomp bg-warning-gradient">Dias</th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
			<div class="row pl-3 pr-3" style="display: none" id="tbl_det">
				<!-- <div class="col-12"> -->
					<div class="d-flex col-12 p-0 m-0 pt-2">
						<div class="d-flex w-100 align-content-center justify-content-center ml-2 mr-2">
							<span class="col-1 font-weight-bold">Buscar: </span>
							<input type="text" class="form-control form-control-sm m-0 ml-1 mr-l p-1 col-8" id="buscar" value=""
								placeholder="Buscar Artículo en la Lista...">
							<div class="col-1"></div>
							<button class="btn btn-sm btn-outline-primary col-2" data-toggle="modal" data-target="#TblArt">
								<i class="fas fa-plus-circle"></i> Agregar Artículo
							</button>
						</div>
					</div>
					<form action="" onsubmit="return false;" class="p-0 m-0" id="frmpeddet">
						<table id="tbl_consultaInvPedidosDet" class="table-striped table-hover table-bordered">
							<thead>
								<tr>
									<th colspan="4" class="text-center txtcomp bg-secondary-gradient"></th>
									<th colspan="2" class="text-center txtcomp bg-warning-gradient">Apartado</th>
									<th colspan="2" class="text-center txtcomp bg-warning-gradient">Exi. CEDIM</th>
									<th colspan="2" class="text-center txtcomp bg-light-gradient  ">Pedido</th>
								</tr>
								<tr>
									<th width="10%" class="text-center txtcomp bg-warning-gradient">Código</th>
									<th width="10%" class="text-center txtcomp bg-warning-gradient">Barra</th>
									<th width="44%" class="text-center txtcomp bg-warning-gradient">Descripción</th>
									<th width="6%"  class="text-center txtcomp bg-warning-gradient">Empaque</th>
									<th width="5%"  class="text-center txtcomp bg-warning-gradient">Und</th>
									<th width="5%"  class="text-center txtcomp bg-warning-gradient">C/B</th>
									<th width="5%"  class="text-center txtcomp bg-warning-gradient">Und</th>
									<th width="5%"  class="text-center txtcomp bg-warning-gradient">C/B</th>
									<th width="5%"  class="text-center txtcomp bg-light-gradient  ">Und</th>
									<th width="5%"  class="text-center txtcomp bg-light-gradient  ">C/B</th>
								</tr>
							</thead>
						</table>
					</form>
					<!-- <form action="" onsubmit="return false;" class="form-inline col-12 p-0 m-0 pt-2"> -->
					<div class="d-flex col-12 p-0 m-0 pt-2 align-items-baseline">
						<div class="d-flex col-2 align-middle font-weight-bold">
							<input id="itemssel" type="text" size="3" class="m-0 p-0 font-weight-bold bg-transparent border-0 text-center"
								disabled value="">Items
						</div>
						<div class="d-flex col-8 align-items-baseline">
							<form class="form-inline w-100" action="" onsubmit="return false;">
								<label for="responsable">Responsable: &nbsp;</label>
								<input type="text" autocomplete="on" class="form-control w-75" id="responsable" value="" placeholder="Nombre del responsable del despacho">
								<input type="hidden" placeholder="Nombre del responsable del despacho">
							</form>
						</div>
						<div class="d-flex col-2 mr-3 justify-content-end">
							<button id="addProcpedido" class="btn btn-info mr-4"><i class="fas fa-check"></i>Procesar</button>
							<button id="delProcpedido" class="btn btn-danger"><i class="fas fa-trash"></i>Eliminar</button>
						</div>
					</div>
					<!-- </form>	 -->
				<!-- </div> -->
			</div>
			<!-- /.card-body -->
		</div>
	</div>
	<!-- /.col -->
</div>
<!-- /.row (main row 2) -->

<input type="hidden" id="horah">
<input type="hidden" id="nrospedidos">

<!-- Modal lista de articulos -->
<div class="modal fade" id="TblArt" style="z-index: 9888;" tabindex="-1" role="dialog" aria-labelledby="TblArtLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg modal-dialog-centered">
		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header bg-primary pt-1 pb-1">
				<h4 class="modal-title">Seleccione un Artículo para Agregarlo a la Lista</h4>
			</div>
			<div class="modal-body p-0" id="contTblArt">
				<form action="" onsubmit="return false;" class="form-inline col-12 p-0 m-0 mt-2">
					<div class="d-flex w-100 align-content-center justify-content-center ml-2 mr-2">
						<span class="col-1 font-weight-bold">Buscar: </span>
						<input type="text" class="form-control form-control-sm m-0 ml-1 mr-l p-1 col-11" id="buscarTblArt" value=""
							placeholder="Buscar Artículo en la Lista...">
					</div>
				</form>
				<form action="" onsubmit="return false;" class="p-0 m-0" id="frmlstart">
					<table id="tbl_ListaArticulos" class="w-100 table table-striped table-hover table-bordered">
						<thead>
							<tr>
								<th width="10%" class="txtcomp text-center bg-warning-gradient">Código</th>
								<th width="10%" class="txtcomp text-center bg-warning-gradient">Barra</th>
								<th width="60%" class="txtcomp text-center bg-warning-gradient">Descripción</th>
								<th width="10%" class="txtcomp text-center bg-warning-gradient">Apartado</th>
								<th width="10%" class="txtcomp text-center bg-warning-gradient">Exist. CEDIM</th>
							</tr>
						</thead>
					</table>
				</form>
			</div>
			<div class="modal-footer pt-2 pb-2 align-items-end justify-content-end align-top">
				<button class="btn btn-outline-danger col-3" class="close" data-dismiss="modal" id="btncerrar">
					Cerrar <i class="fas fa-times-circle"></i>
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Modal Detalle de la Despacho -->
<div class="modal fade" id="VerDespa" style="z-index: 9888;" tabindex="-1" role="dialog" aria-labelledby="VerDespaLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg modal-dialog-centered">
		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header bg-primary pt-1 pb-1">
				<h4 class="modal-title">Detalle del Despacho</h4>
				<button type="button" data-dismiss="modal" aria-label="Close" class="btn btn-danger btn-lg float-right">
					<span class="fas fa-window-close float-right" aria-hidden="true"></span>
				</button>
			</div>
			<div class="modal-body p-0" id="contVerDespa">
				<form action="" onsubmit="return false;" class="form-inline col-12 p-0 m-0 mt-2">
					<div class="d-flex w-100 align-content-center justify-content-center ml-2 mr-2">
						<span class="col-1 font-weight-bold">Buscar: </span>
						<input type="text" class="form-control form-control-sm m-0 ml-1 mr-l p-1 col-11" id="buscarVerDespa" value=""
							placeholder="Buscar Artículo en la Lista...">
					</div>
				</form>
				<form action="" onsubmit="return false;" class="p-1 m-0" id="frmlstartdesp">
					<table id="tbl_ListaArticulosDesp" class="w-100 table-striped table-hover table-bordered">
						<thead>
							<tr>
								<th colspan="3" class="text-center bg-dark-gradient">
									<span class="bg-primary rounded border border-white p-0 pl-1 pr-1" id="nrodesp"></span>
								</th>
								<th colspan="2" class="txtcomp text-center bg-warning-gradient">Despacho</th>
							</tr>
							<tr>
								<th width="10%" class="txtcomp text-center bg-warning-gradient">Barra</th>
								<th width="60%" class="txtcomp text-center bg-warning-gradient">Descripción</th>
								<th width="10%" class="txtcomp text-center bg-warning-gradient">Presentación</th>
								<th width="10%" class="txtcomp text-center bg-warning-gradient">Cantidad</th>
								<th width="10%" class="txtcomp text-center bg-warning-gradient">Bultos</th>
							</tr>
						</thead>
						<tbody></tbody>
						<tfoot>
							<tr>
								<th colspan="2" class="text-center bg-dark-gradient"></th>
								<th class="text-right  bg-dark-gradient"></th>
								<th class="text-right bg-dark-gradient"></th>
								<th class="text-right bg-dark-gradient"></th>
							</tr>
						</tfoot>
					</table>
				</form>
			</div>
		</div>
	</div>
</div>

<script>
	var procSoli  = [];   // Despachos a Procesar
	var docsinval = [];   // Transferencias invalidas atadas al despacho
	var hoy = moment().subtract(3, 'd').format('YYYY-MM-DD');
	var min = moment($('#fecinibimas').val(), 'DD-MM-YYYY').format('YYYY-MM-DD');
	var max = moment().format('YYYY-MM-DD');
	
	$('#fechat').val(hoy);
	$('#fechat').attr('min', min);
	$('#fechat').attr('max', max);
	
	// Se consultan las tiendas activas en el dashboard para seleccionar
	$.ajax({
		data: {
			opcion: "listaTiendasBDES",
			sqlcnx: 1,
			idpara: ptodas+'¬'+ptienda,
		},
		type: "POST",
		dataType: "json",
		url: "app/DBProcs.php",
		success: function(data) {
			$("#select_tiendas").append('<option value="*">Todas las Tiendas</option>');
			for (i=0; i<data.length; i++) {
				$("#select_tiendas").append('<option value="'+ data[i].codigo+'">'+data[i].nombre+'</option>');
			}
		}
	})

	$('#tbl_consultaInvPedidosList').DataTable({ scrollY: "25vh" }).columns.adjust().draw();
	$('#tbl_ListaArticulos').DataTable({ scrollY: "50vh" }).columns.adjust().draw();

	$('#TblArt').on('shown.bs.modal', function () {
		$('#buscarTblArt').val('').focus();
		$('#tbl_ListaArticulos').DataTable().clear();
		setTimeout(function() {
			$('#tbl_ListaArticulos').DataTable({ scrollY: "50vh" }).columns.adjust().draw();
		}, 100);
	})

	$('#select_tiendas').on('change', function() {
		$('#prioritarios').prop('checked', false);
		$('#prioritarios').prop('disabled', false );
		$('#exlocmin').prop('disabled', false );
		if($(this).val()=='*') {
			$('.prioritarios').addClass('d-none');
		} else {
			if($('#statuspedi').val()==0) {
				$('.prioritarios').removeClass('d-none');
			}
		}
		prepararview( $('#statuspedi').val() );
	})

	$('#statuspedi').on('change', function() {
		$('#prioritarios').prop('checked', false);
		$('#prioritarios').prop('disabled', false );
		$('#exlocmin').prop('disabled', false );
		if($(this).val()!=0) {
			$('.prioritarios').addClass('d-none');
		} else {
			if($('#select_tiendas').val()!='*') {
				$('.prioritarios').removeClass('d-none');
			}
		}
		prepararview( $(this).val() );
	});

	function tabE(obj,e) { 
		var e=(typeof event!='undefined')?window.event:e;// IE : Moz 
		if(e.keyCode==13){ 
			var ele = document.forms.namedItem('frmpeddet').elements; 
			for(var i=0;i<ele.length;i++) { 
				var q=(i==ele.length-1)?0:i+2;// if last element : if any other 
				if(obj==ele[i]) {
					ele[q].focus();
					break;
				} 
			} 
			return false; 
		} 
	}

	function prepararview(valor) {
		$('#tbl_det').css('display', 'none');
		$('#tbl_Espera').css('display', 'none');
		$('#tbl_Pedidos').css('display', 'none');
		$('#btn_procesar').css('display', 'none');
		$('#tbl_Procesadas').css('display', 'none');
		$('#tbl_Eliminadas').css('display', 'none');
		$('#tbl_consultaInvEspera').DataTable().clear()
		setTimeout(function() {
			$('#tbl_consultaInvEspera').DataTable({ scrollY: "72vh" }).columns.adjust().draw();
		}, 100);
		$('#tbl_consultaInvProcesado').DataTable().clear()
		setTimeout(function() {
			$('#tbl_consultaInvProcesado').DataTable({ scrollY: "67vh" }).columns.adjust().draw();
		}, 100);
		$('#tbl_consultaInvPedidosDet').DataTable().clear()
		setTimeout(function() {
			$('#tbl_consultaInvPedidosDet').DataTable({ scrollY: "23vh" }).columns.adjust().draw();
		}, 100);
		$('#tbl_consultaInvPedidosList').DataTable().clear()
		setTimeout(function() {
			$('#tbl_consultaInvPedidosList').DataTable({ scrollY: "25vh" }).columns.adjust().draw();
		}, 100);
		$('#tbl_consultaInvPedidosElim').DataTable().clear()
		setTimeout(function() {
			$('#tbl_consultaInvPedidosElim').DataTable({ scrollY: "72vh" }).columns.adjust().draw();
		}, 100);
		switch ( valor ) {
			case '1':
				$('#tbl_Espera').css('display', 'inline');
				break;

			case '3':
				$('#tbl_Procesadas').css('display', 'inline');
				break;

			case '0':
				$('#tbl_Pedidos').css('display', 'inline');
				break;

			case '2':
				$('#tbl_Eliminadas').css('display', 'inline');
				break;
		}
	}

	$('#prioritarios').on('click', function() {
		prepararview( $('#statuspedi').val() );
	});

	$('#btn_consultar').on('click', function() {
		prepararview( $('#statuspedi').val() );
		switch ( $('#statuspedi').val() ) {
			case '0':
				consultaSoliPedi();
				break;

			case '1':
				consLstPreparacion();
				break;

			case '2':
				consultaSoliElim();
				break;

			case '3':
				consLstProcesados();
				break;
		}
	})

	$("#buscar").keyup(function() {
		// Buscar en la tabla
		$('#tbl_consultaInvPedidosDet').dataTable().fnFilter(this.value);
	});

	$("#buscarTblArt").keyup(function(e) {
		if(e.which == '13') {
			lstArticulos(this.value)
		}
	});

	$('#addProcpedido').click( function() {
		if($('#responsable').val().trim()!='') {
			cargando2('show');
			$('#tbl_consultaInvPedidosDet').dataTable().fnFilter('');
			// Se preparan los arrays de datos
			datos      = [];
			dtold      = [];
			codigo     = [];
			cantidad   = [];
			existcedim = [];
			exilocal   = [];
			empaque    = [];

			$('input[name="chknropedido"]:checked').each(function() {
				datos.push($(this).val());
				dtold.push($(this).val());
			});

			$('#nrospedidos').val(datos);
			
			$("input[name='total_pedidos[]']").each(function() {
				cantidad.push( $(this).val() );
				codigo.push( $(this).data('codigo') );
				existcedim.push( $(this).data('existcedim') );
				empaque.push( $(this).data('empaque') );
				exilocal.push( 0 );
			});

			if( $('#prioritarios').is(':checked') ) {
				var params = new FormData();
				params.append('sqlcnx'  , 1);
				params.append('opcion'  , 'guardarSolicPedi');
				params.append('tienda'  , $('#select_tiendas').val());
				params.append('usidnom' , $('#uinombre').val() + ' (' + $('#uilogin').val() + ')');
				params.append('material', codigo);
				params.append('exicedim', existcedim);
				params.append('exilocal', exilocal);
				params.append('pedido'  , cantidad);
				params.append('empaque' , empaque);
				$.ajax({
					url         : "app/DBProcs.php",
					contentType : false,
					processData : false,
					cache       : false,
					data        : params,
					type        : "POST",
					dataType    : "json",
					success : function(data) {
						data = data.split('¬');
						if (data[0] == 1) { 
							$('#nrospedidos').val(data[2]);
						}else{
							msg.fire({
								title: '!!! A T E N C I Ó N ¡¡¡',
								icon: 'warning',
								html: data[1],
								showCancelButton: false,
							}).then((result) => {
								if (result.value) {
									return false;
								}
							})
						}
					}
				}).done(function() {
					guardarpedido();
				});
			} else {
				guardarpedido();
			}
		} else {
			msg.fire({
				title: '!!! A T E N C I Ó N ¡¡¡',
				icon: 'info',
				html: 'Por favor ingrese el nombre del responsable de preparar el despacho',
				showCancelButton: false,
				onClose: $('#responsable').focus().select()
			})
		}
	});

	function guardarpedido() {
		$.ajax({
			url: "app/DBProcs.php",
			data: {
				opcion      : "procesarPedidosDespacho",
				id_data     : $('#nrospedidos').val().split(','),
				datacod     : codigo,
				datacant    : cantidad,
				datacedim   : existcedim,
				dataempaque : empaque,
				usidnom     : $('#uinombre').val() + ' (' + $('#uilogin').val() + ')',
				nomresp     : $('#responsable').val().trim(),
				priori      : ($('#prioritarios').is(':checked') ? 1 : 0),
				sqlcnx      : 1
			},
			type: "POST",
			dataType: "json",
			success: function(data) {
				data = data.split('¬');
				if (data[0] == 1) {
					cargando2('hide'); 
					msg.fire({
						title: '!!! A T E N C I Ó N ¡¡¡',
						icon: 'success',
						html: data[1],
						showCancelButton: false,
					})
					window.location='ordendespacho-'+data[2];
				}else{
					msg.fire({
						title: '!!! A T E N C I Ó N ¡¡¡',
						icon: 'error',
						html: data[1],
						showCancelButton: false,
					});
				}
			}
		}).done(function() {
			if( $('#prioritarios').is(':checked') ) {
				$.ajax({
					url: "app/DBProcs.php",
					data: {
						opcion  : "marcarPedidosDespacho",
						id_data : dtold,
						datacod : codigo,
						nvoped  : $('#nrospedidos').val(),
						sqlcnx  : 1
					},
					type: "POST",
					dataType: "json",
					success : function(data) {
						data = data.split('¬');
						if (data[0] == 0) { 
							msg.fire({
								title: '!!! A T E N C I Ó N ¡¡¡',
								icon: 'error',
								html: data[1],
								showCancelButton: false,
							}).then((result) => {
								if (result.value) {
									return false;
								}
							});
						}
					}
				});
			}
		}).done(function() {
			$('#contenido_ppal').load('app/db_consulta_lista_pedidos.html?t=' + moment().format("HH:mm:ss"));
			cargando2('hide');
		});
	}

	$('#delProcpedido').click( function() {
		msg.fire({
			title: '!!! A T E N C I Ó N ¡¡¡',
			icon: 'info',
			html: 'Esta acción no se puede revertir.<br>¿Desea Continuar con la Eliminación?',
			reverseButtons: true
		}).then((result) => {
			if (result.value) {
				cargando2('show');
				// BUSCAR DATOS DEL DETALLE CADA QUE SE DE CLICK EN UN CHECKBOX
				datos    = [];
				codigo   = [];
				cantidad = [];

				$('input[name="chknropedido"]:checked').each(function() {
					datos.push($(this).val());
				});

				$("input[name='codigo[]']").each(function() {
					codigo.push($(this).val());
				});
				
				$("input[name='total_pedidos[]']").each(function() {
					cantidad.push($(this).val());
				});
					
				$.ajax({
					url: "app/DBProcs.php",
					data: {
						opcion   : "cancelarPedidosDespacho",
						id_data  : datos,
						datacod  : codigo,
						datacant : cantidad,
						usidnom  : $('#uinombre').val() + ' (' + $('#uilogin').val() + ')',
						sqlcnx   : 1
					},
					type: "POST",
					dataType: "json",
					success : function(data) {
						data = data.split('¬');
						if (data[0] == 1) {
							cargando2('hide'); 
							msg.fire({
								title: '!!! A T E N C I Ó N ¡¡¡',
								icon: 'success',
								html: data[1],
								showCancelButton: false,
							}).then((result) => {
								if (result.value) {
									$('#contenido_ppal').load('app/db_consulta_lista_pedidos.html?t='+moment().format("HH:mm:ss"));
								}
							})
						}else{
							msg.fire({
								title: '!!! A T E N C I Ó N ¡¡¡',
								icon: 'error',
								html: data[1],
								showCancelButton: false,
							});
						}
					}
				});
			}
		})	
	});

	// Agrega un articulo nuevo al listado del pedido
	function agregararticulo(codigo, barra, descripcion, apartado, empaque, existcedim) {
		$('#TblArt').modal('hide');
		if($('#inpund'+codigo).length == 0) {
			var rowNode = 
			$('#tbl_consultaInvPedidosDet').DataTable().row.add({ 
				'codigo': codigo,
				'barra': barra,
				'descripcion': descripcion,
				'empaque': empaque,
				'apartado': apartado,
				'existcedim': (existcedim-apartado).toFixed(0),
				'total_pedidos': 0,
			}).draw( false ).node();

			$(rowNode).css( 'color', 'blue' ).animate( { color: 'green', fontWeight: '900' }, '900' );

			$('#inpund'+codigo).attr('data-existcedim', existcedim);
			$('#inpund'+codigo).attr('data-empaque', empaque);
			$('#inpund'+codigo).attr('data-codigo', codigo);

			$('#inpbul'+codigo).attr('data-existcedim', existcedim);
			$('#inpbul'+codigo).attr('data-empaque', empaque);
			$('#inpbul'+codigo).attr('data-codigo', codigo);
		}

		$('#inpund'+codigo).focus().select();
		setTimeout(function() {
			$($('#tbl_consultaInvPedidosDet').DataTable()
				.row($('#inpund'+codigo)
					.parent().parent()
				).node()
			).css( 'color', 'blue' ).animate( { color: 'green', fontWeight: '900' }, '900' )
			$('#itemssel').val($('#tbl_consultaInvPedidosDet').DataTable().rows().count());
		}, 200);
	}

	// Para limpiar los campos de filtros
	function limpiarFiltros() {
		// Se recarga la pagina para inicializar todo
		cargarcontenido('consulta_lista_pedidos');
	}

	// Inicializa las tablas para que cuando se muestren al cambiar de estatus esten limpias
	function inicializaTablas() {
		$('#tbl_consultaInvEspera').empty();
		$('#tbl_consultaInvEspera').width('100%');
		$('#tbl_consultaInvProcesado').empty();
		$('#tbl_consultaInvProcesado').width('100%');
		$('#tbl_consultaInvPedidosList').empty();
		$('#tbl_consultaInvPedidosList').width('100%');
	}

	// Lista los artículos para agregar al pedido
	function lstArticulos(articulo) {
		cargando('show')
		tomar_datos = $.ajax({
			url: "app/DBProcs.php",
			data: {
				opcion: "listaArticulosDispoCedim",
				idpara: articulo,
				sqlcnx: 1,
			},
			type: "POST",
			dataType: "json",
			success : function(data) {
				if(data.length>0) {
					$('#tbl_ListaArticulos').dataTable({
						scrollY: "50vh",
						scrollCollapse: false,
						data: data,
						autoWidth: false,
						columns: [
							{ data: 'codigo',      sClass: "txtcomp text-left align-middle" },
							{ data: 'barra',       sClass: "txtcomp text-left align-middle" },
							{ data: 'descripcion', sClass: "txtcomp text-left align-middle" },
							{ data: 'apartado',    sClass: "txtcomp text-right align-middle", render: $.fn.dataTable.render.number(",", ".", 2) },
							{ data: 'existcedim',  sClass: "txtcomp text-right align-middle", render: $.fn.dataTable.render.number(",", ".", 2) },
						]
					});	
				}
			}
		}).done(function() {
			cargando('hide');
			$('#TblArt').modal('show');
		})
	}

	// Obtiene la información de la lista de  pedidos
	function consultaSoliPedi() {
		var params = '';
		params+= ($('#select_tiendas').val() != '' ? $('#select_tiendas').val() : '*')+'¬';
		params+= $("#statuspedi").val() + '¬' + ($('#prioritarios').is(':checked') ? 1 : 0) + '¬' + $('#exlocmin').val();
		cargando('show');
		tomar_datos = $.ajax({
			data: {
				opcion: "consultaListaPedidos",
				idpara: params,
				sqlcnx: 1,
			},	
			type: "POST",
			dataType: "json",
			url: "app/DBProcs.php",
			success: function (data) {
				// Mostrar boton para procesar el pedido en un principio
				cargando('hide');
				$('#tbl_consultaInvPedidosList').dataTable({
					scrollY: "25vh",
					data: data,
					autoWidth: false,
					columns: [
						{ data: "fechaPedido",   sClass: "txtcomp align-middle" },
						{ data: "localidadName", sClass: "txtcomp align-middle" },
						{ data: "solicitadoPor", sClass: "txtcomp align-middle" },
						{ data: null, sClass: "txtcomp align-middle",
							render: function(data) { return  String('00000'+data.numero).slice(-5); }
						},
						{ data: 'dias', sClass: "txtcomp text-center align-middle" },
						{ data: null,
							render: function(data){
								return '<div class="form-group mb-0 pt-0 pb-0">'+
										'<div class="form-check mb-0 pt-0 pb-0">'+
											'<input style="cursor: pointer;" class="form-check-input p-0 chknropedido" name="chknropedido" id="chk'+data.numero+'" '+
												'type="checkbox" data-localidad="'+data.localidad+'" value="'+data.numero+'"'+
												($('#prioritarios').is(':checked') ? ' checked ' : '') + '>' +
											'<label style="cursor: pointer;" class="btn-link form-check-label p-0" for="chk'+data.numero+'">'+
												'Seleccione'+
											'</label>'+
										'</div>'+
									'</div>';
						   }
						},
					],
					initComplete: function() {
						$('#tbl_consultaInvPedidosList').DataTable().columns.adjust().draw();
					}
				});

				// Buscar datos del detalle cada que se de click en un checkbox
				$( '[name="chknropedido"]').on('click', function() {
					datos = [];
					tiendas = [];
					$('input[name="chknropedido"]:checked').each(function() {
						datos.push($(this).val());
						tiendas.push($(this).data('localidad'));
					});
					getDeta(datos, tiendas);
				});
			}
		}).done(function() {
			if( $('#prioritarios').is(':checked') ) {
				datos = [];
				tiendas = [];
				$('input[name="chknropedido"]:checked').each(function() {
					datos.push($(this).val());
					tiendas.push($(this).data('localidad'));
				}).queue(function() {
					getDeta(datos, tiendas);
				}).queue(function() { cargando('hide'); });
			} else {
				cargando('hide');
			}
		})
	}

	// FUNCION PARA BUSCAR EL DETALLE DEL PEDIDO
	function getDeta(datos){
		cargando('show');
		$.ajax({
				url: "app/DBProcs.php",
				data: {
				opcion: "buscardetpedidos",
				idpara: datos,
				tienda: tiendas,
				priori: ($('#prioritarios').is(':checked') ? 1 : 0),
				exlomi: $('#exlocmin').val(),
				sqlcnx: 1
			},
			type: "POST",
			dataType: "json",
			success : function(data) {
				if (data.length > 0) {
					$('#tbl_det').css('display', 'inline');
					$('#tbl_consultaInvPedidosDet').dataTable({
						scrollY: ($('.prioritarios').is(':visible') ? "20vh" : "25vh"),
						data: data,
						autoWidth: false,
						searching: true,
						columns: [
							{ data: 'codigo',      sClass: "txtcomp text-left align-middle" },
							{ data: "barra",       sClass: "txtcomp text-left align-middle" },
							{ data: 'descripcion', sClass: "txtcomp text-left align-middle" },
							{ data: 'empaque',     sClass: "txtcomp text-right align-middle", render: $.fn.dataTable.render.number(",", ".", 2) },
							{ data: 'apartado',    sClass: "txtcomp text-right align-middle", render: $.fn.dataTable.render.number(",", ".", 2) },
							{ data: null,
								render: function(data,type,row,meta) {
									return (data.apartado / data.empaque).toFixed(2);
								},
								sClass: "txtcomp m-0 p-0 text-right align-middle",
							},
							{ data: 'existcedim',  sClass: "txtcomp text-right align-middle", render: $.fn.dataTable.render.number(",", ".", 2) },
							{ data: null,
								render: function(data,type,row,meta) {
									return (data.existcedim / data.empaque).toFixed(2);
								},
								sClass: "txtcomp m-0 p-0 pr-1 text-right align-middle",
							},
							{ data: null,
								render: function(data,type,row,meta) {
									var invDisp = (data.existcedim-data.apartado);
									return	'<input type = "number" min = "0" max = "'+invDisp+'"'+
											' onkeydown="return tabE(this,event);"'+
											' onkeyup="if ($(this).val()>'+invDisp+') {'+
											'	$(this).val('+(invDisp<0?null:invDisp)+')};'+
											' convCant($(this).val(),'+data.codigo+',1,'+data.empaque+')"'+
											' onchange="convCant($(this).val(),'+data.codigo+',1,'+data.empaque+')"'+
											' data-existcedim="'+data.existcedim+'"'+
											' data-empaque="'+data.empaque+'"'+
											' data-codigo="'+data.codigo+'"'+
											' id="inpund'+data.codigo+'"'+
											' name="total_pedidos[]" value="'+data.total_pedidos+'"'+
											' class="p-0 m-0 text-center selectSize">';
								}, sClass: "txtcomp m-0 p-0 text-left align-middle",
							},
							{ data: null,
								render: function(data,type,row,meta) {
									var cajaApar = (data.apartado / data.empaque).toFixed(2);
									var cajaCedi = (data.existcedim / data.empaque).toFixed(2);
									var cajaDisp = (cajaCedi - cajaApar).toFixed(2);
									var cajaSoli = (data.total_pedidos / data.empaque).toFixed(2);
									return	'<input type = "number" step="0.01" min = "0" max = "'+cajaDisp+'"'+
											' onkeydown="return tabE(this,event);"'+
											' onkeyup="if ($(this).val()>'+cajaDisp+') {'+
											'	$(this).val('+(cajaDisp<0?null:cajaDisp)+')};'+
											' convCant($(this).val(), '+data.codigo+', 2, '+data.empaque+')"'+
											' onchange="convCant($(this).val(),'+data.codigo+',2,'+data.empaque+')"'+
											' data-existcedim="'+data.existcedim+'"'+
											' data-empaque="'+data.empaque+'"'+
											' data-codigo="'+data.codigo+'"'+
											' id="inpbul'+data.codigo+'"'+
											' value="'+cajaSoli+'" class="p-0 m-0 text-center selectSize">';
								}, sClass: "txtcomp m-0 p-0 text-left align-middle",
							}
						],
						initComplete: function() {
							$('#tbl_consultaInvPedidosDet').DataTable().columns.adjust().draw();
							$('#itemssel').val(this.api().rows().count())
						}
					});	
					$('#btn_consultar').prop( "disabled", true );
					$('#prioritarios').prop( "disabled", true );
					$('#exlocmin').prop('disabled', true );
					$('#select_tiendas').prop( "disabled", true );
					$('#statuspedi').prop( "disabled", true );				
				} else {
					$('#btn_consultar').prop( "disabled", false );
					$('#prioritarios').prop( "disabled", false );
					$('#exlocmin').prop('disabled', false );
					$('#select_tiendas').prop( "disabled", false );
					$('#statuspedi').prop( "disabled", false );
					$('#tbl_det').css('display', 'none');
				}
			}
		}).done(function() { cargando('hide'); $('#responsable').focus(); });	
	}

	// Obtiene la información de la lista de  pedidos
	function consultaSoliElim() {
		var params = '';
		params+= ($('#select_tiendas').val() != '' ? $('#select_tiendas').val() : '*')+'¬';
		params+= $("#statuspedi").val() + '¬' + ($('#prioritarios').is(':checked') ? 1 : 0);
		cargando('show');
		tomar_datos = $.ajax({
			data: {
				opcion: "consultaListaPedidos",
				idpara: params,
				sqlcnx: 1,
			},	
			type: "POST",
			dataType: "json",
			url: "app/DBProcs.php",
			success: function (data) {
				// Mostrar boton para procesar el pedido en un principio
				cargando('hide');
				$('#tbl_consultaInvPedidosElim').dataTable({
					scrollY: "72vh",
					data: data,
					autoWidth: false,
					columns: [
						{ data: "fechaPedido"  , sClass: "txtcomp align-middle" },
						{ data: "localidadName", sClass: "txtcomp align-middle" },
						{ data: null, sClass: "txtcomp align-middle",
							render: function(data) { return  String('00000'+data.numero).slice(-5); }
						},
						{ data: null, sClass: "txtcomp align-middle",
							render: function(data) { return data.fechadesp; }
						},
						{ data: 'usuariodesp', sClass: "txtcomp align-middle" },
						{ data: 'dias'       , sClass: "txtcomp text-center align-middle" },
					],
					initComplete: function() {
						$('#tbl_consultaInvPedidosElim').DataTable().columns.adjust().draw();
					}
				});
			}
		}).done(function() {
			cargando('hide');
		});
	}
	
	// Obtiene la información de la lista de  pedidos
	function consLstPreparacion() {
		cargando('show');
		tomar_datos = $.ajax({
			data: {
				opcion: "consLstPreparacion",
				idpara: $('#select_tiendas').val(),
				sqlcnx: 1,
			},	
			type: "POST",
			dataType: "json",
			url: "app/DBProcs.php",
			success: function (data) {
				// Mostrar boton para procesar el pedido en un principio
				cargando('hide');
				$('#tbl_consultaInvEspera').dataTable({
					scrollY: "72vh",
					data: data,
					autoWidth: true,
					columns: [
						{ data: 'localidad',   sClass: "txtcomp align-middle" },
						{ data: null, sClass: "txtcomp align-middle",
							render: function(data){
								return '<a href="ordendespacho-'+data.iddespacho+'">'+data.numerodesp+'</a>';
							}
						},
						{ data: 'fechaEspera', sClass: "txtcomp align-middle" },
						{ data: 'responsable', sClass: "txtcomp align-middle" },
						{ data: 'dias',        sClass: "txtcomp align-middle text-center" },
						{ data: null,
							render: function(data,type){
								return '<form action="" onsubmit="return false">'+
										'<input style="display: none;" placeholder="Ejemplo: 2345,3456,2356">'+
										'<input type="text" class="form-control form-control-sm pl-1 pr-1 inptrans" '+
											'placeholder="Ejemplo: 2345,3456,2356" '+
											'value="'+(data.transfer==null?'':data.transfer)+'" '+
											'id="inp'+data.local_id+'_'+data.iddespacho+'">'+
										'</form>';
							},
							sClass: "txtcomp align-middle" },
						{ data: null,
							render: function(data,type){
								return '<div class="form-group mb-0 pt-0 pb-0">'+
										'<div class="form-check mb-0 pt-0 pb-0">'+
											'<input style="cursor: pointer;" class="form-check-input p-0 chkdespacho"'+
												' name="chkdespacho" id="chk'+data.iddespacho+'"'+
												' type="checkbox" value="'+data.local_id+'_'+data.iddespacho+'">'+
											'<label style="cursor: pointer;" class="btn-link form-check-label p-0" for="chk'+data.iddespacho+'">'+
												'Procesar'+
											'</label>'+
										'</div>'+
									'</div>';
							}
						},
					],
					initComplete: function() {
						$('#tbl_consultaInvEspera').DataTable().columns.adjust().draw();
					}
				});

				// Buscar datos del detalle cada que se de click en un checkbox
				$( '[name="chkdespacho"]').on('click', function() {
					procSoli = [];
					$('input[name="chkdespacho"]:checked').each(function() {
						procSoli.push({ 'nrodesp': $(this).val(), 'nrostran': $('#inp'+$(this).val()).val() });
					});
					if(procSoli.length>0) {
						$('#btn_consultar').prop( "disabled", true );
						$('#prioritarios').prop( "disabled", true );
						$('#exlocmin').prop('disabled', true );
						$('#select_tiendas').prop( "disabled", true );
						$('#statuspedi').prop( "disabled", true );
						$('#btn_procesar').css('display', 'inline');
					} else {
						$('#btn_consultar').prop( "disabled", false );
						$('#prioritarios').prop( "disabled", false );
						$('#exlocmin').prop('disabled', false );
						$('#select_tiendas').prop( "disabled", false );
						$('#statuspedi').prop( "disabled", false );
						$('#btn_procesar').css('display', 'none');
					}
				});
			}
		}).done(function() {
			cargando('hide');
		});
	}

	// Obtiene la información de la lista de  pedidos
	function consLstProcesados() {
		cargando('show');
		tomar_datos = $.ajax({
			data: {
				opcion: "consLstProcesados",
				idpara: $('#select_tiendas').val(),
				sqlcnx: 1,
			},	
			type: "POST",
			dataType: "json",
			url: "app/DBProcs.php",
			success: function (data) {
				// Mostrar boton para procesar el pedido en un principio
				cargando('hide');
				$('#tbl_consultaInvProcesado').dataTable({
					scrollY: "67vh",
					data: data,
					autoWidth: true,
					columns: [
						{ data: 'localidad',  sClass: "txtcomp align-middle" },
						{ data: 'numerosoli', sClass: "txtcomp align-middle text-center" },
						{ data: 'fechasoli',  sClass: "txtcomp align-middle text-center text-nowrap" },
						{ data: 'numerodesp', sClass: "txtcomp align-middle text-center" },
						{ data: 'fechadesp',  sClass: "txtcomp align-middle text-center text-nowrap" },
						{ data: 'dias',       sClass: "txtcomp align-middle text-center" },
						{ data: 'transfer',   sClass: "txtcomp align-middle text-center" },					
					],
					initComplete: function() {
						$('#tbl_consultaInvProcesado').DataTable().columns.adjust().draw();
					}
				});
			}
		}).done(function() {
			cargando('hide');
		});
	}

	$('#procSoli').click( function() {
		flag = 0;
		inptrans = [];
		inpnde   = [];
		procSoli = [];
		$('input[name="chkdespacho"]:checked').each(function() {
			var nrosol = $(this).val()
			procSoli.push({
				'nrodesp' : nrosol.substr(nrosol.indexOf('_')+1),
				'nrostran': $('#inp'+$(this).val()).val(),
				'nrosol'  : nrosol,
				'tipo'    : nrosol.substr(0, nrosol.indexOf('_'))==3 ? 4 : 3,
			});
		});
		$.each( procSoli, function( key, value ) {
			if(value['nrostran'].trim()=='') {
				flag = 1;
			} else {
				if(value['tipo']==4) {
					inpnde.push( value['nrostran'].trim() );
				} else {
					inptrans.push( value['nrostran'].trim() );
				}
			}
		});
		if(flag==1) {
			msg.fire({
				title: '!!! A T E N C I Ó N ¡¡¡',
				icon: 'info',
				html: 'Debe ingresar los números de documentos enlazados en cada uno de los despachos',
				showCancelButton: false,
			});
		} else {
			docsinval = [];
			valtrans = (inptrans.toString()).split(',').filter(Boolean);
			valtrans.forEach( function(valor) {
				if(isNaN(valor.trim())) {
					docsinval.push( 'Transferencia: ' + valor.trim() );
				} else {
					$.ajax({
						url: "app/DBProcs.php",
						data: {
							opcion : "validarTrans",
							sqlcnx : 1,
							idpara : valor.trim(),
						},
						type: "POST",
						dataType: "text",
						async: false,
						success : function(data) {
							if(data==0) {
								docsinval.push( 'Transferencia: ' + valor.trim() );
							}
						}
					});
				}
			});
			valnde = (inpnde.toString()).split(',').filter(Boolean);
			valnde.forEach( function(valor) {
				if(isNaN(valor.trim())) {
					docsinval.push( 'Factura: ' + valor.trim() );
				} else {
					$.ajax({
						url: "app/DBProcs.php",
						data: {
							opcion : "validarNDE",
							sqlcnx : 1,
							idpara : valor.trim(),
						},
						type: "POST",
						dataType: "text",
						async: false,
						success : function(data) {
							if(data==0) {
								docsinval.push( 'Factura: ' + valor.trim() );
							}
						}
					})
				}
			})
			if(docsinval.length > 0) {
				var txt = '';
				$.each(docsinval, function(index, valor) {
					txt += valor + '<br>'
				})
				msg.fire({
					title: '!!! A T E N C I Ó N ¡¡¡',
					icon: 'info',
					html: 'Los siguientes números de Documentos son inválidos, por favor revisar<br>'+txt,
					showCancelButton: false,
				});
			} else {
				cargando2('show');
				$.ajax({
					url: "app/DBProcs.php",
					data: {
						opcion  : "procesarSoliPedi",
						sqlcnx  : 1,
						usidnom : $('#uinombre').val() + ' (' + $('#uilogin').val() + ')',
						idpara  : procSoli,
					},
					type: "POST",
					dataType: "text",
					success : function(data) {
						data = data.split('¬');
						if (data[0] == 1) { 
							msg.fire({
								title: '!!! A T E N C I Ó N ¡¡¡',
								icon: 'success',
								html: data[1],
								showCancelButton: false,
							}).then((result) => {
								if (result.value) {
									$('#contenido_ppal').load('app/db_consulta_lista_pedidos.html?t='+moment().format("HH:mm:ss"));
								}
							});
						}else{
							msg.fire({
								title: '!!! A T E N C I Ó N ¡¡¡',
								icon: 'error',
								html: data[1],
								showCancelButton: false,
							});
						}
					}
				}).done(function() { cargando2('hide'); });
			}
		}
	});

	function convCant(valor, id, tipo, empaque) {
		if(valor>0) {
			if(tipo == 1) {
				$("#inpbul"+id).val((valor / empaque).toFixed(2));
			} else {
				$("#inpund"+id).val((empaque * valor).toFixed(0));
			}
		} else {
			$("#inpbul"+id).val(valor);
			$("#inpund"+id).val(valor);
		}
	}

	function mostrarDespacho(id) {
		cargando('show')
		tomar_datos = $.ajax({
			url: "app/DBProcs.php",
			data: {
				opcion: "mostrarDespacho",
				idpara: id,
				sqlcnx: 1,
			},
			type: "POST",
			dataType: "json",
			success : function(data) {
				var cabecera = data['cabecera'];
				var detalle = data['detalle'];
				if(detalle.length>0) {
					$('#nrodesp').html('Número Despacho: ' + id + ' - Tienda: ' + cabecera[0]['localidad']);
					$('#tbl_ListaArticulosDesp').dataTable({
						scrollY: "50vh",
						scrollCollapse: false,
						data: detalle,
						autoWidth: false,
						searching: true,
						order: [1 , 'asc'],
						columns: [
							{ data: 'barra',       sClass: "txtcomp text-left align-middle"},
							{ data: 'descripcion', sClass: "txtcomp text-left align-middle"},
							{ data: 'empaque',     sClass: "txtcomp text-right align-middle", render: $.fn.dataTable.render.number(",", ".", 2)},
							{ data: 'pedido',      sClass: "txtcomp text-right align-middle", render: $.fn.dataTable.render.number(",", ".", 2)},
							{ data: 'cant_bulto',  sClass: "txtcomp text-right align-middle", render: $.fn.dataTable.render.number(",", ".", 2)},
						],
						footerCallback: function (row, data, start, end, display) {
							totald0 = this.api().rows().count();
							totald3 = this.api()
								.column(3) //numero de columna a sumar
								.data() //obtenemos los datos en la columna
								.reduce(function (a, b) {
									return parseInt(a) + parseInt(b);
								}, 0);
							totald4 = this.api()
								.column(4) //numero de columna a sumar
								.data() //obtenemos los datos en la columna
								.reduce(function (a, b) {
									return parseFloat(a) + parseFloat(b);
								}, 0);

							$(this.api().column(0).footer()).html((isNaN(totald0) ? 0 : totald0).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,') + ' Artículos Pedidos');
							$(this.api().column(2).footer()).html('Totales');
							$(this.api().column(3).footer()).html((isNaN(totald3) ? 0 : totald3).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,'));
							$(this.api().column(4).footer()).html((isNaN(totald4) ? 0 : totald4).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,'));
						},
					});	
				}
			}
		}).done(function() {
			cargando('hide');
			$('#tbl_ListaArticulosDesp').dataTable().fnFilter('');
			$('#VerDespa').modal('show');
		})	
	}

	$('#VerDespa').on('shown.bs.modal', function () {
		$('#contVerDespa').css( 'display', 'block' );
		$('#tbl_ListaArticulosDesp').DataTable().columns.adjust().draw();
		$('#buscarVerDespa').focus();
	})
</script>